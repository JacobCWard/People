<polymer-element name="pj-sortable-tiles-editor" attributes="editedItem editedItemIndex">
  <template>
    <style>
      div {
        padding: 10px;

      }

      label {
        display: inline-block;
        width: 90px;
      }

      input {
        width: 60px;
      }

      :host {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 100;
        background: #fff;
        font-family: Helvetica, Arial, sans-serif;
      }
    </style>
    <template if="{{displayed}}">
      <template bind="{{editedItem}}">
        <div><label>Gap Left ({{rect.gap.left}})</label>
          <button on-click="{{gapLeftIncrease}}">Inc</button>
          <button on-click="{{gapLeftDecrease}}">Dec</button>
        </div>
        <div><label>Gap Top ({{rect.gap.top}})</label>
          <button on-click="{{gapTopIncrease}}">Inc</button>
          <button on-click="{{gapTopDecrease}}">Dec</button>
        </div>
        <div><label>Width ({{rect.width - rect.gap.left}})</label>
          <button on-click="{{widthIncrease}}">Inc</button>
          <button on-click="{{widthDecrease}}">Dec</button>
        </div>
        <div><label>Height ({{rect.height - rect.gap.left}})</label>
          <button on-click="{{heightIncrease}}">Inc</button>
          <button on-click="{{heightDecrease}}">Dec</button>
        </div>
        <div><label>Priority ({{rect.priority}})</label>
          <button on-click="{{priorityIncrease}}">Inc</button>
          <button on-click="{{priorityDecrease}}">Dec</button>
        </div>
        <div><label></label>
          <button on-click="{{close}}">Done</button>
        </div>
      </template>
    </template>
  </template>
  <script>
    (function () {
      function powerIncrease(obj, property) {
        var power = 1;
        while (power <= obj[property])
            power *= 2;
        obj[property] = power;
      }
      
      function powerDecrease(obj, property, minimum) {
        var power = 1;
        while (power * 2 < obj[property])
          power *= 2;
        if (power < minimum) {
          power = minimum;
        }
        obj[property] = power;
      }

      Polymer('pj-sortable-tiles-editor', {
        displayed: false,
        sortableTilesModel: null,
        editedItem: null,
        editedItemIndex: 0,
        attached: function () {
          this.sortableTilesModel = this.parentNode.host;
        },
        gapLeftIncrease: function () {
          var lastGap = this.editedItem.rect.gap.left;
          powerIncrease(this.editedItem.rect.gap, "left");
          this.editedItem.rect.width += this.editedItem.rect.gap.left - lastGap;
          this.fire("pj-sortable-tiles-refresh");
        },
        gapLeftDecrease: function () {
          var lastGap = this.editedItem.rect.gap.left;
          powerDecrease(this.editedItem.rect.gap, "left", 1);
          this.editedItem.rect.width += this.editedItem.rect.gap.left - lastGap;
          this.fire("pj-sortable-tiles-refresh");
        },
        gapTopIncrease: function () {
          var lastGap = this.editedItem.rect.gap.top;
          powerIncrease(this.editedItem.rect.gap, "top");
          this.editedItem.rect.height += this.editedItem.rect.gap.top - lastGap;
          this.fire("pj-sortable-tiles-refresh");
        },
        gapTopDecrease: function () {
          var lastGap = this.editedItem.rect.gap.top;
          powerDecrease(this.editedItem.rect.gap, "top", 1);
          this.editedItem.rect.height += this.editedItem.rect.gap.top - lastGap;
          this.fire("pj-sortable-tiles-refresh");
        },
        widthIncrease: function () {
          this.editedItem.rect.width -= this.editedItem.rect.gap.left;
          powerIncrease(this.editedItem.rect, "width");
          this.editedItem.rect.width += this.editedItem.rect.gap.left;
          this.fire("pj-sortable-tiles-refresh");
        },
        widthDecrease: function () {
          this.editedItem.rect.width -= this.editedItem.rect.gap.left;
          powerDecrease(this.editedItem.rect, "width");
          this.editedItem.rect.width += this.editedItem.rect.gap.left;
          this.fire("pj-sortable-tiles-refresh");
        },
        heightIncrease: function () {
          this.editedItem.rect.height -= this.editedItem.rect.gap.top;
          powerIncrease(this.editedItem.rect, "height");
          this.editedItem.rect.height += this.editedItem.rect.gap.top;
          this.fire("pj-sortable-tiles-refresh");
        },
        heightDecrease: function () {
          this.editedItem.rect.height -= this.editedItem.rect.gap.top;
          powerDecrease(this.editedItem.rect, "height");
          this.editedItem.rect.height += this.editedItem.rect.gap.top;
          this.fire("pj-sortable-tiles-refresh");
        },
        priorityIncrease: function (sss) {
          console.log("priorityIncrease", sss);
          this.sortableTilesModel.reprioritizeItem(this.editedItemIndex, true);
        },
        priorityDecrease: function () {
          console.log("priorityDecrease");
          this.sortableTilesModel.reprioritizeItem(this.editedItemIndex, false);
        },
        editedItemChanged: function () {
          if (this.editedItem) {
            this.displayed = true;
          }
        },
        close: function () {
          this.editedItem = null;
          this.displayed = false;
          this.fire("pj-sortable-tiles-editor-close");
        }
      });
    })();
  </script>
</polymer-element>