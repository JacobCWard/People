<!doctype html>
<head>
    <title>Launcher</title>
    <script src="/vendor/fast-json-patch/src/json-patch-duplex.js"></script>
    <script src="/vendor/platform/platform.js"></script>
    <script src="/vendor/PuppetJs/src/puppet.js"></script>
    
    <link rel="import" href="/vendor/polymer/polymer.html">


    <link rel="import" href="/vendor/polymer-ui-toggle-button/polymer-ui-toggle-button.html">
    <link rel="import" href="/vendor/polymer-ui-field/polymer-ui-field.html">

    <link rel="import" href="/vendor/imported-template/imported-template.html">
    <link rel="import" href="/vendor/tomalec-sortable-list/src/tomalec-sortable-list.html">
    <link rel="import" href="/vendor/pj-sortable-tiles/src/pj-sortable-tiles.html">
    <link rel="import" href="/vendor/warpech-display-router/warpech-display-router.html">

    <link rel="stylesheet" href="/css/style.css">

    <!-- Import our elements -->
    <link rel="import" href="/elements/dashboard/pj-dashboard.html">

</head>

<body>
  <template id="root" bind>
    <pj-dashboard search="{{ searchBar.query$ }}">
      <div id="menu">
          <ul>
              <template bind="{{ menu }}">
                  <template is="imported-template" content="{{ Html }}"></template>
              </template>
          </ul>
      </div>
      <polymer-ui-field class="align-center">
          <a href="/do-nothing">Do nothing</a>
          <label>Toggle sorting </label>
          <polymer-ui-toggle-button id="toggleSortable" offcaption="Locked" oncaption="Sorting"></polymer-ui-toggle-button>
      </polymer-ui-field>
      <template bind="{{ results }}">
        <!-- FIXME: hardcoded priority -->
        <pj-sortable-tiles class="workspace launcher" disabled  cellWidth="128" cellHeight="128" priorities='[{"width":1,"height":1,"priority":0.3},{"width":2,"height":1,"priority":0.9},{"width":2,"height":1,"priority":0.8},{"width":1,"height":1,"priority":0.1}]'>
          <template is="imported-template" content="{{ Html }}"></template>   
        </pj-sortable-tiles>
      </template>
        <template repeat="{{ workspaces }}">
        <warpech-display-route match-path="^\/launcher\/workspace\/{{appName}}\/" display-selector=".workspace.{{appName}}"></warpech-display-route>
        <tomalec-sortable-list class="workspace {{appName}}" disabled>
            <template bind="{{ master }}">
                <template is="imported-template" content="{{ Html }}"></template>  
            </template> 
        </tomalec-sortable-list>
        <warpech-display-route match-path="^\/launcher\/[^w][^o][^r][^k][^s][^p][^a][^c][^e]" display-selector=".workspace.launcher"></warpech-display-route>
      </template>
    </pj-dashboard>
  </template>
  <script>
    document.addEventListener("polymer-ready", function polymerReadyForLauncher(){
      window.puppet = new Puppet(null, function (obj) { //setting up global for console access
        var rootTemplate = document.getElementById("root");
        rootTemplate.bindingDelegate = new PolymerExpressions;
        rootTemplate.model = obj;

        window.setTimeout(function templateReady(){
          // Consider use of `changed` event 
          document.addEventListener('click', function toggleSortable(e) {
            if(e.target.id = "toggleSortable"){
            var list = document.querySelector('tomalec-sortable-list');
            if (list) {
              list.disabled = this.value;// XXX: `this.value` was not yet changed so lets use it as `!this.newVal`.
            }
          }
          });
        });
      });
    });
  </script>
</body>
